<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/FrontEnd/Restoran/app/apply-restaurant-owner/page.tsx">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/FrontEnd/Restoran/app/apply-restaurant-owner/page.tsx" />
              <option name="updatedContent" value="&quot;use client&quot;;&#10;&#10;import { useState } from &quot;react&quot;;&#10;import { useRouter } from &quot;next/navigation&quot;;&#10;import { Button } from &quot;@/components/ui/button&quot;;&#10;import { Input } from &quot;@/components/ui/input&quot;;&#10;import { Label } from &quot;@/components/ui/label&quot;;&#10;import { Textarea } from &quot;@/components/ui/textarea&quot;;&#10;import { Card, CardContent, CardDescription, CardHeader, CardTitle } from &quot;@/components/ui/card&quot;;&#10;import { useToast } from &quot;@/hooks/use-toast&quot;;&#10;import { Building2, Loader2 } from &quot;lucide-react&quot;;&#10;&#10;export default function ApplyRestaurantOwnerPage() {&#10;  const router = useRouter();&#10;  const { toast } = useToast();&#10;  const [loading, setLoading] = useState(false);&#10;  const [formData, setFormData] = useState({&#10;    businessName: &quot;&quot;,&#10;    businessDescription: &quot;&quot;,&#10;    businessAddress: &quot;&quot;,&#10;    businessPhone: &quot;&quot;,&#10;    businessEmail: &quot;&quot;,&#10;    category: &quot;&quot;,&#10;    additionalNotes: &quot;&quot;,&#10;  });&#10;&#10;  const handleSubmit = async (e: React.FormEvent) =&gt; {&#10;    e.preventDefault();&#10;    setLoading(true);&#10;&#10;    try {&#10;      const token = localStorage.getItem(&quot;token&quot;);&#10;      if (!token) {&#10;        toast({&#10;          title: &quot;Hata&quot;,&#10;          description: &quot;Lütfen önce giriş yapın&quot;,&#10;          variant: &quot;destructive&quot;,&#10;        });&#10;        router.push(&quot;/login&quot;);&#10;        return;&#10;      }&#10;&#10;      const response = await fetch(&quot;http://localhost:5272/api/Account/restaurant-ownership-application&quot;, {&#10;        method: &quot;POST&quot;,&#10;        headers: {&#10;          &quot;Content-Type&quot;: &quot;application/json&quot;,&#10;          Authorization: `Bearer ${token}`,&#10;        },&#10;        body: JSON.stringify(formData),&#10;      });&#10;&#10;      const data = await response.json();&#10;&#10;      if (response.ok) {&#10;        toast({&#10;          title: &quot;Başarılı&quot;,&#10;          description: data.message || &quot;Başvurunuz alındı ve incelenecektir.&quot;,&#10;        });&#10;        router.push(&quot;/profile&quot;);&#10;      } else {&#10;        toast({&#10;          title: &quot;Hata&quot;,&#10;          description: data.message || &quot;Başvuru gönderilemedi&quot;,&#10;          variant: &quot;destructive&quot;,&#10;        });&#10;      }&#10;    } catch (error) {&#10;      console.error(&quot;Başvuru hatası:&quot;, error);&#10;      toast({&#10;        title: &quot;Hata&quot;,&#10;        description: &quot;Bir hata oluştu. Lütfen tekrar deneyin.&quot;,&#10;        variant: &quot;destructive&quot;,&#10;      });&#10;    } finally {&#10;      setLoading(false);&#10;    }&#10;  };&#10;&#10;  const handleChange = (e: React.ChangeEvent&lt;HTMLInputElement | HTMLTextAreaElement&gt;) =&gt; {&#10;    setFormData({&#10;      ...formData,&#10;      [e.target.name]: e.target.value,&#10;    });&#10;  };&#10;&#10;  return (&#10;    &lt;div className=&quot;container mx-auto px-4 py-8 max-w-3xl&quot;&gt;&#10;      &lt;Card&gt;&#10;        &lt;CardHeader&gt;&#10;          &lt;div className=&quot;flex items-center gap-3&quot;&gt;&#10;            &lt;Building2 className=&quot;h-8 w-8 text-primary&quot; /&gt;&#10;            &lt;div&gt;&#10;              &lt;CardTitle className=&quot;text-2xl&quot;&gt;Restoran Sahipliği Başvurusu&lt;/CardTitle&gt;&#10;              &lt;CardDescription&gt;&#10;                Restoranınızı platformumuza eklemek için başvuru formu&#10;              &lt;/CardDescription&gt;&#10;            &lt;/div&gt;&#10;          &lt;/div&gt;&#10;        &lt;/CardHeader&gt;&#10;        &lt;CardContent&gt;&#10;          &lt;form onSubmit={handleSubmit} className=&quot;space-y-6&quot;&gt;&#10;            &lt;div className=&quot;space-y-2&quot;&gt;&#10;              &lt;Label htmlFor=&quot;businessName&quot;&gt;İşletme Adı *&lt;/Label&gt;&#10;              &lt;Input&#10;                id=&quot;businessName&quot;&#10;                name=&quot;businessName&quot;&#10;                value={formData.businessName}&#10;                onChange={handleChange}&#10;                placeholder=&quot;Örn: Lezzet Durağı Restaurant&quot;&#10;                required&#10;                maxLength={500}&#10;              /&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div className=&quot;space-y-2&quot;&gt;&#10;              &lt;Label htmlFor=&quot;businessDescription&quot;&gt;İşletme Açıklaması *&lt;/Label&gt;&#10;              &lt;Textarea&#10;                id=&quot;businessDescription&quot;&#10;                name=&quot;businessDescription&quot;&#10;                value={formData.businessDescription}&#10;                onChange={handleChange}&#10;                placeholder=&quot;Restoranınız hakkında detaylı bilgi verin...&quot;&#10;                required&#10;                maxLength={1000}&#10;                rows={4}&#10;              /&gt;&#10;              &lt;p className=&quot;text-sm text-muted-foreground&quot;&gt;&#10;                {formData.businessDescription.length}/1000 karakter&#10;              &lt;/p&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div className=&quot;space-y-2&quot;&gt;&#10;              &lt;Label htmlFor=&quot;businessAddress&quot;&gt;İşletme Adresi *&lt;/Label&gt;&#10;              &lt;Textarea&#10;                id=&quot;businessAddress&quot;&#10;                name=&quot;businessAddress&quot;&#10;                value={formData.businessAddress}&#10;                onChange={handleChange}&#10;                placeholder=&quot;Restoranınızın tam adresi...&quot;&#10;                required&#10;                maxLength={500}&#10;                rows={3}&#10;              /&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div className=&quot;grid grid-cols-1 md:grid-cols-2 gap-4&quot;&gt;&#10;              &lt;div className=&quot;space-y-2&quot;&gt;&#10;                &lt;Label htmlFor=&quot;businessPhone&quot;&gt;İşletme Telefonu *&lt;/Label&gt;&#10;                &lt;Input&#10;                  id=&quot;businessPhone&quot;&#10;                  name=&quot;businessPhone&quot;&#10;                  type=&quot;tel&quot;&#10;                  value={formData.businessPhone}&#10;                  onChange={handleChange}&#10;                  placeholder=&quot;0555 555 55 55&quot;&#10;                  required&#10;                  maxLength={20}&#10;                /&gt;&#10;              &lt;/div&gt;&#10;&#10;              &lt;div className=&quot;space-y-2&quot;&gt;&#10;                &lt;Label htmlFor=&quot;businessEmail&quot;&gt;İşletme E-postası&lt;/Label&gt;&#10;                &lt;Input&#10;                  id=&quot;businessEmail&quot;&#10;                  name=&quot;businessEmail&quot;&#10;                  type=&quot;email&quot;&#10;                  value={formData.businessEmail}&#10;                  onChange={handleChange}&#10;                  placeholder=&quot;info@restaurant.com&quot;&#10;                  maxLength={100}&#10;                /&gt;&#10;              &lt;/div&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div className=&quot;space-y-2&quot;&gt;&#10;              &lt;Label htmlFor=&quot;category&quot;&gt;Kategori *&lt;/Label&gt;&#10;              &lt;Input&#10;                id=&quot;category&quot;&#10;                name=&quot;category&quot;&#10;                value={formData.category}&#10;                onChange={handleChange}&#10;                placeholder=&quot;Örn: Türk Mutfağı, İtalyan, Fast Food&quot;&#10;                required&#10;                maxLength={100}&#10;              /&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div className=&quot;space-y-2&quot;&gt;&#10;              &lt;Label htmlFor=&quot;additionalNotes&quot;&gt;Ek Notlar&lt;/Label&gt;&#10;              &lt;Textarea&#10;                id=&quot;additionalNotes&quot;&#10;                name=&quot;additionalNotes&quot;&#10;                value={formData.additionalNotes}&#10;                onChange={handleChange}&#10;                placeholder=&quot;Eklemek istediğiniz diğer bilgiler...&quot;&#10;                maxLength={2000}&#10;                rows={4}&#10;              /&gt;&#10;              &lt;p className=&quot;text-sm text-muted-foreground&quot;&gt;&#10;                {formData.additionalNotes.length}/2000 karakter&#10;              &lt;/p&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div className=&quot;bg-muted p-4 rounded-lg&quot;&gt;&#10;              &lt;p className=&quot;text-sm text-muted-foreground&quot;&gt;&#10;                * işaretli alanlar zorunludur. Başvurunuz incelendikten sonra size geri dönüş yapılacaktır.&#10;              &lt;/p&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div className=&quot;flex gap-4&quot;&gt;&#10;              &lt;Button&#10;                type=&quot;submit&quot;&#10;                className=&quot;flex-1&quot;&#10;                disabled={loading}&#10;              &gt;&#10;                {loading ? (&#10;                  &lt;&gt;&#10;                    &lt;Loader2 className=&quot;mr-2 h-4 w-4 animate-spin&quot; /&gt;&#10;                    Gönderiliyor...&#10;                  &lt;/&gt;&#10;                ) : (&#10;                  &quot;Başvuruyu Gönder&quot;&#10;                )}&#10;              &lt;/Button&gt;&#10;              &lt;Button&#10;                type=&quot;button&quot;&#10;                variant=&quot;outline&quot;&#10;                onClick={() =&gt; router.back()}&#10;                disabled={loading}&#10;              &gt;&#10;                İptal&#10;              &lt;/Button&gt;&#10;            &lt;/div&gt;&#10;          &lt;/form&gt;&#10;        &lt;/CardContent&gt;&#10;      &lt;/Card&gt;&#10;    &lt;/div&gt;&#10;  );&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/Src/Core/RestaurantManagment.Application/Common/DTOs/JobPosting/JobPostingDto.cs">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/Src/Core/RestaurantManagment.Application/Common/DTOs/JobPosting/JobPostingDto.cs" />
              <option name="updatedContent" value="namespace RestaurantManagment.Application.Common.DTOs.JobPosting;&#10;&#10;public class JobPostingDto&#10;{&#10;    public string Id { get; set; } = string.Empty;&#10;    public string Title { get; set; } = string.Empty;&#10;    public string Description { get; set; } = string.Empty;&#10;    public string Requirements { get; set; } = string.Empty;&#10;    public string Position { get; set; } = string.Empty;&#10;    public decimal? Salary { get; set; }&#10;    public string EmploymentType { get; set; } = string.Empty;&#10;    public DateTime PostedDate { get; set; }&#10;    public DateTime? ExpiryDate { get; set; }&#10;    public bool IsActive { get; set; }&#10;    public string RestaurantId { get; set; } = string.Empty;&#10;    public string RestaurantName { get; set; } = string.Empty;&#10;    public int ApplicationCount { get; set; }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/Src/Core/RestaurantManagment.Application/Common/Interfaces/IAccountService.cs">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/Src/Core/RestaurantManagment.Application/Common/Interfaces/IAccountService.cs" />
              <option name="updatedContent" value="using RestaurantManagment.Domain.Models;&#10;&#10;namespace RestaurantManagment.Application.Common.Interfaces;&#10;&#10;public interface IAccountService&#10;{&#10;    Task CreateApplicationAsync(OwnershipApplication application);&#10;    Task&lt;OwnershipApplication?&gt; GetApplicationByIdAsync(int id);&#10;    Task&lt;IEnumerable&lt;OwnershipApplication&gt;&gt; GetPendingApplicationsAsync();&#10;    Task&lt;IEnumerable&lt;OwnershipApplication&gt;&gt; GetApplicationsByUserIdAsync(string userId);&#10;    Task ApproveApplicationAsync(int applicationId, string reviewerId);&#10;    Task RejectApplicationAsync(int applicationId, string reviewerId, string reason);&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/Src/Core/RestaurantManagment.Application/Common/Interfaces/IAppDbContext.cs">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/Src/Core/RestaurantManagment.Application/Common/Interfaces/IAppDbContext.cs" />
              <option name="originalContent" value="&#10;using Microsoft.EntityFrameworkCore;&#10;using RestaurantManagment.Domain.Models;&#10;&#10;namespace RestaurantManagment.Application.Common.Interfaces;&#10;&#10;public interface IAppDbContext&#10;{&#10;    public new DbSet&lt;AppUser&gt; Users { get; set; }&#10;    public DbSet&lt;Restaurant&gt; Restaurants { get; set; }&#10;    public DbSet&lt;Menu&gt; Menus { get; set; }&#10;    public DbSet&lt;MenuItem&gt; MenuItems { get; set; }&#10;    public DbSet&lt;Table&gt; Tables { get; set; }&#10;    public DbSet&lt;Reservation&gt; Reservations { get; set; }&#10;    public DbSet&lt;Order&gt; Orders { get; set; }&#10;    public DbSet&lt;OrderItem&gt; OrderItems { get; set; }&#10;    public DbSet&lt;JobPosting&gt; JobPostings { get; set; }&#10;    public DbSet&lt;JobApplication&gt; JobApplications { get; set; }&#10; &#10;    &#10;    Task&lt;int&gt; SaveChangesAsync(CancellationToken cancellationToken = default);&#10;}" />
              <option name="updatedContent" value="using Microsoft.EntityFrameworkCore;&#10;using RestaurantManagment.Domain.Models;&#10;&#10;namespace RestaurantManagment.Application.Common.Interfaces;&#10;&#10;public interface IAppDbContext&#10;{&#10;    public new DbSet&lt;AppUser&gt; Users { get; set; }&#10;    public DbSet&lt;Restaurant&gt; Restaurants { get; set; }&#10;    public DbSet&lt;Menu&gt; Menus { get; set; }&#10;    public DbSet&lt;MenuItem&gt; MenuItems { get; set; }&#10;    public DbSet&lt;Table&gt; Tables { get; set; }&#10;    public DbSet&lt;Reservation&gt; Reservations { get; set; }&#10;    public DbSet&lt;Order&gt; Orders { get; set; }&#10;    public DbSet&lt;OrderItem&gt; OrderItems { get; set; }&#10;    public DbSet&lt;JobPosting&gt; JobPostings { get; set; }&#10;    public DbSet&lt;JobApplication&gt; JobApplications { get; set; }&#10;    public DbSet&lt;OwnershipApplication&gt; OwnershipApplications { get; set; }&#10;    &#10;    Task&lt;int&gt; SaveChangesAsync(CancellationToken cancellationToken = default);&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/Src/Core/RestaurantManagment.Domain/Models/Common/TopSellingItemDto.cs">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/Src/Core/RestaurantManagment.Domain/Models/Common/TopSellingItemDto.cs" />
              <option name="updatedContent" value="namespace RestaurantManagment.Domain.Models.Common;&#10;&#10;public class TopSellingItemDto&#10;{&#10;    public string MenuItemId { get; set; } = string.Empty;&#10;    public string MenuItemName { get; set; } = string.Empty;&#10;    public int QuantitySold { get; set; }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/Src/Infrastructure/RestaurantManagment.Infrastructure/DependencyInjection.cs">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/Src/Infrastructure/RestaurantManagment.Infrastructure/DependencyInjection.cs" />
              <option name="originalContent" value="using Microsoft.Extensions.DependencyInjection;&#10;using RestaurantManagment.Application.Common.Interfaces;&#10;using RestaurantManagment.Infrastructure.Services;&#10;&#10;namespace RestaurantManagment.Infrastructure;&#10;&#10;public static class DependencyInjection&#10;{&#10;    public static IServiceCollection AddInfrastructure(this IServiceCollection services)&#10;    {&#10;        services.AddScoped&lt;IEmailService, EmailService&gt;();&#10;        services.AddScoped&lt;IJwtTokenService, JwtTokenService&gt;();&#10;        &#10;        return services;&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="using Microsoft.Extensions.DependencyInjection;&#13;&#10;using RestaurantManagment.Application.Common.Interfaces;&#13;&#10;using RestaurantManagment.Infrastructure.Services;&#13;&#10;&#13;&#10;namespace RestaurantManagment.Infrastructure;&#13;&#10;&#13;&#10;public static class DependencyInjection&#13;&#10;{&#13;&#10;    public static IServiceCollection AddInfrastructure(this IServiceCollection services)&#13;&#10;    {&#13;&#10;        services.AddScoped&lt;IEmailService, EmailService&gt;();&#13;&#10;        services.AddScoped&lt;IJwtTokenService, JwtTokenService&gt;();&#13;&#10;        services.AddScoped&lt;IAccountService, AccountService&gt;();&#13;&#10;        &#13;&#10;        return services;&#13;&#10;    }&#13;&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/Src/Infrastructure/RestaurantManagment.Infrastructure/Services/AccountService.cs">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/Src/Infrastructure/RestaurantManagment.Infrastructure/Services/AccountService.cs" />
              <option name="originalContent" value="&#10;" />
              <option name="updatedContent" value="using Microsoft.EntityFrameworkCore;&#10;using RestaurantManagment.Application.Common.Interfaces;&#10;using RestaurantManagment.Domain.Models;&#10;&#10;namespace RestaurantManagment.Infrastructure.Services;&#10;&#10;public class AccountService : IAccountService&#10;{&#10;    private readonly IAppDbContext _context;&#10;&#10;    public AccountService(IAppDbContext context)&#10;    {&#10;        _context = context;&#10;    }&#10;&#10;    public async Task CreateApplicationAsync(OwnershipApplication application)&#10;    {&#10;        _context.OwnershipApplications.Add(application);&#10;        await _context.SaveChangesAsync();&#10;    }&#10;&#10;    public async Task&lt;OwnershipApplication?&gt; GetApplicationByIdAsync(int id)&#10;    {&#10;        return await _context.OwnershipApplications&#10;            .Include(a =&gt; a.User)&#10;            .FirstOrDefaultAsync(a =&gt; a.Id.ToString() == id.ToString() &amp;&amp; !a.IsDeleted);&#10;    }&#10;&#10;    public async Task&lt;IEnumerable&lt;OwnershipApplication&gt;&gt; GetPendingApplicationsAsync()&#10;    {&#10;        return await _context.OwnershipApplications&#10;            .Include(a =&gt; a.User)&#10;            .Where(a =&gt; a.Status == ApplicationStatus.Pending &amp;&amp; !a.IsDeleted)&#10;            .OrderBy(a =&gt; a.ApplicationDate)&#10;            .ToListAsync();&#10;    }&#10;&#10;    public async Task&lt;IEnumerable&lt;OwnershipApplication&gt;&gt; GetApplicationsByUserIdAsync(string userId)&#10;    {&#10;        return await _context.OwnershipApplications&#10;            .Where(a =&gt; a.UserId == userId &amp;&amp; !a.IsDeleted)&#10;            .OrderByDescending(a =&gt; a.ApplicationDate)&#10;            .ToListAsync();&#10;    }&#10;&#10;    public async Task ApproveApplicationAsync(int applicationId, string reviewerId)&#10;    {&#10;        var application = await _context.OwnershipApplications.FindAsync(applicationId);&#10;        if (application == null)&#10;            throw new Exception(&quot;Başvuru bulunamadı&quot;);&#10;&#10;        application.Status = ApplicationStatus.Approved;&#10;        application.ReviewedBy = reviewerId;&#10;        application.ReviewedAt = DateTime.UtcNow;&#10;&#10;        await _context.SaveChangesAsync();&#10;    }&#10;&#10;    public async Task RejectApplicationAsync(int applicationId, string reviewerId, string reason)&#10;    {&#10;        var application = await _context.OwnershipApplications.FindAsync(applicationId);&#10;        if (application == null)&#10;            throw new Exception(&quot;Başvuru bulunamadı&quot;);&#10;&#10;        application.Status = ApplicationStatus.Rejected;&#10;        application.ReviewedBy = reviewerId;&#10;        application.ReviewedAt = DateTime.UtcNow;&#10;        application.RejectionReason = reason;&#10;&#10;        await _context.SaveChangesAsync();&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/Src/Infrastructure/RestaurantManagment.Persistance/Configurations/JobPostingConfiguration.cs">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/Src/Infrastructure/RestaurantManagment.Persistance/Configurations/JobPostingConfiguration.cs" />
              <option name="updatedContent" value="using Microsoft.EntityFrameworkCore;&#10;using Microsoft.EntityFrameworkCore.Metadata.Builders;&#10;using RestaurantManagment.Domain.Models;&#10;&#10;namespace RestaurantManagment.Persistance.Configurations;&#10;&#10;public class JobPostingConfiguration : IEntityTypeConfiguration&lt;JobPosting&gt;&#10;{&#10;    public void Configure(EntityTypeBuilder&lt;JobPosting&gt; builder)&#10;    {&#10;        builder.HasKey(j =&gt; j.Id);&#10;&#10;        builder.Property(j =&gt; j.Title)&#10;            .IsRequired()&#10;            .HasMaxLength(200);&#10;&#10;        builder.Property(j =&gt; j.Description)&#10;            .IsRequired()&#10;            .HasMaxLength(2000);&#10;&#10;        builder.Property(j =&gt; j.Requirements)&#10;            .IsRequired()&#10;            .HasMaxLength(1000);&#10;&#10;        builder.Property(j =&gt; j.Position)&#10;            .IsRequired()&#10;            .HasMaxLength(100);&#10;&#10;        builder.Property(j =&gt; j.EmploymentType)&#10;            .IsRequired()&#10;            .HasMaxLength(50);&#10;&#10;        // Relationships&#10;        builder.HasOne(j =&gt; j.Restaurant)&#10;            .WithMany(r =&gt; r.JobPostings)&#10;            .HasForeignKey(j =&gt; j.RestaurantId)&#10;            .OnDelete(DeleteBehavior.Cascade);&#10;&#10;        // Indexes&#10;        builder.HasIndex(j =&gt; j.RestaurantId);&#10;        builder.HasIndex(j =&gt; j.IsActive);&#10;&#10;        // Soft Delete Query Filter&#10;        builder.HasQueryFilter(j =&gt; !j.IsDeleted);&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/Src/Presentation/RestaurantManagment.WebAPI/Controllers/AccountController.cs">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/Src/Presentation/RestaurantManagment.WebAPI/Controllers/AccountController.cs" />
              <option name="originalContent" value="using AutoMapper;&#10;using Microsoft.AspNetCore.Authorization;&#10;using Microsoft.AspNetCore.Identity;&#10;using Microsoft.AspNetCore.Mvc;&#10;using RestaurantManagment.Application.Common.DTOs.Account;&#10;using RestaurantManagment.Application.Common.Interfaces;&#10;using RestaurantManagment.Domain.Models;&#10;using RestaurantManagment.Infrastructure.Services;&#10;&#10;namespace RestaurantManagment.WebAPI.Controllers&#10;{&#10;    [Route(&quot;api/[controller]&quot;)]&#10;    [ApiController]&#10;    public class AccountController(&#10;        UserManager&lt;AppUser&gt; userManager,&#10;        SignInManager&lt;AppUser&gt; signInManager,&#10;        IMapper mapper,&#10;        IEmailService emailService,&#10;        IJwtTokenService jwtTokenService) : Controller&#10;    {&#10;        &#10;        [HttpPost(&quot;register&quot;)]&#10;        public async Task&lt;IActionResult&gt; Register(UserRegisterDto userRegisterDto)&#10;        {&#10;            if (!ModelState.IsValid)&#10;                return BadRequest(ModelState);&#10;            &#10;            var existingUserByUsername = await userManager.FindByNameAsync(userRegisterDto.Username);&#10;            if (existingUserByUsername != null)&#10;            {&#10;                ModelState.AddModelError(&quot;Username&quot;, &quot;Bu kullanıcı adı zaten kullanılıyor&quot;);&#10;                return BadRequest(ModelState);&#10;            }&#10;            &#10;            &#10;            var existingUserByEmail = await userManager.FindByEmailAsync(userRegisterDto.Email);&#10;            if (existingUserByEmail != null)&#10;            {&#10;                if (existingUserByEmail.IsDeleted)&#10;                {&#10;                    ModelState.AddModelError(&quot;Email&quot;, &quot;Bu e-posta adresi silinmiş bir hesaba ait. Lütfen farklı bir e-posta kullanın veya destek ile iletişime geçin,Veya hesabınızı geri yükleyin.&quot;);&#10;                    return BadRequest(ModelState);&#10;                }&#10;                ModelState.AddModelError(&quot;Email&quot;, &quot;Bu e-posta adresi zaten kullanılıyor&quot;);&#10;                return BadRequest(ModelState);&#10;            }&#10;&#10;            var user = mapper.Map&lt;AppUser&gt;(userRegisterDto);&#10;&#10;            var result = await userManager.CreateAsync(user, userRegisterDto.Password);&#10;            if (!result.Succeeded)&#10;            {&#10;                foreach (var error in result.Errors)&#10;                {&#10;                    ModelState.AddModelError(error.Code, error.Description);&#10;                }&#10;&#10;                return BadRequest(ModelState);&#10;            }&#10;&#10;            await userManager.AddToRoleAsync(user, &quot;Customer&quot;);&#10;&#10;           &#10;            var emailToken = await userManager.GenerateEmailConfirmationTokenAsync(user);&#10;&#10;            &#10;            var verificationLink =&#10;                $&quot;{Request.Scheme}://{Request.Host}/api/Account/verify-email?userId={user.Id}&amp;token={Uri.EscapeDataString(emailToken)}&quot;;&#10;&#10;            try&#10;            {&#10;                await emailService.SendEmailVerificationAsync(user.Email!, user.UserName!, verificationLink);&#10;            }&#10;            catch (Exception ex)&#10;            {&#10;              &#10;                return Ok(new&#10;                {&#10;                    Message = &quot;Kayıt başarılı ancak doğrulama e-postası gönderilemedi. Lütfen tekrar deneyin.&quot;,&#10;                    UserId = user.Id,&#10;                    EmailSendError = ex.Message&#10;                });&#10;            }&#10;&#10;            return Ok(new&#10;            {&#10;                Message = &quot;Kayıt başarılı! Lütfen e-posta adresinizi kontrol edin ve hesabınızı doğrulayın.&quot;,&#10;                UserId = user.Id,&#10;                Email = user.Email&#10;            });&#10;        }&#10;&#10;        [HttpGet(&quot;verify-email&quot;)]&#10;        public async Task&lt;IActionResult&gt; VerifyEmail([FromQuery] string userId, [FromQuery] string token)&#10;        {&#10;            if (string.IsNullOrEmpty(userId) || string.IsNullOrEmpty(token))&#10;            {&#10;                return BadRequest(new { Message = &quot;Geçersiz doğrulama linki&quot; });&#10;            }&#10;&#10;            var user = await userManager.FindByIdAsync(userId);&#10;            if (user == null)&#10;            {&#10;                return NotFound(new { Message = &quot;Kullanıcı bulunamadı&quot; });&#10;            }&#10;&#10;            if (user.EmailConfirmed)&#10;            {&#10;                return Redirect($&quot;{Request.Scheme}://{Request.Host.Host}:3000/email-verified?status=already-verified&quot;);&#10;            }&#10;&#10;            var result = await userManager.ConfirmEmailAsync(user, token);&#10;            if (result.Succeeded)&#10;            {&#10;              &#10;                return Redirect($&quot;{Request.Scheme}://{Request.Host.Host}:3000/email-verified?status=success&quot;);&#10;            }&#10;            else&#10;            {&#10;                return Redirect($&quot;{Request.Scheme}://{Request.Host.Host}:3000/email-verified?status=failed&quot;);&#10;            }&#10;        }&#10;&#10;        [HttpPost(&quot;resend-verification&quot;)]&#10;        public async Task&lt;IActionResult&gt; ResendVerificationEmail([FromBody] ResendVerificationDto dto)&#10;        {&#10;            var user = await userManager.FindByEmailAsync(dto.Email);&#10;            if (user == null)&#10;            {&#10;                return NotFound(new { Message = &quot;Kullanıcı bulunamadı&quot; });&#10;            }&#10;&#10;            if (user.EmailConfirmed)&#10;            {&#10;                return BadRequest(new { Message = &quot;E-posta adresi zaten doğrulanmış&quot; });&#10;            }&#10;&#10;            var emailToken = await userManager.GenerateEmailConfirmationTokenAsync(user);&#10;            var verificationLink =&#10;                $&quot;{Request.Scheme}://{Request.Host}/api/Account/verify-email?userId={user.Id}&amp;token={Uri.EscapeDataString(emailToken)}&quot;;&#10;&#10;            try&#10;            {&#10;                await emailService.SendEmailVerificationAsync(user.Email!, user.UserName!, verificationLink);&#10;                return Ok(new { Message = &quot;Doğrulama e-postası tekrar gönderildi&quot; });&#10;            }&#10;            catch (Exception ex)&#10;            {&#10;                return StatusCode(500, new { Message = &quot;E-posta gönderilemedi&quot;, Error = ex.Message });&#10;            }&#10;        }&#10;&#10;        [HttpPost(&quot;login&quot;)]&#10;        public async Task&lt;IActionResult&gt; Login(UserLoginDto userLoginDto)&#10;        {&#10;            if (!ModelState.IsValid)&#10;                return BadRequest(ModelState);&#10;&#10;            var user = await userManager.FindByEmailAsync(userLoginDto.Email);&#10;            if (user == null)&#10;            {&#10;                return Unauthorized(new { Message = &quot;Geçersiz e-posta veya şifre&quot; });&#10;            }&#10;            &#10;&#10;&#10;            if (!user.EmailConfirmed)&#10;            {&#10;                return Unauthorized(new&#10;                {&#10;                    Message = &quot;Lütfen önce e-posta adresinizi doğrulayın&quot;,&#10;                    RequiresEmailVerification = true,&#10;                    Email = user.Email&#10;                });&#10;            }&#10;&#10;            var result = await signInManager.CheckPasswordSignInAsync(user, userLoginDto.Password, false);&#10;            if (!result.Succeeded)&#10;            {&#10;                return Unauthorized(new { Message = &quot;Geçersiz e-posta veya şifre&quot; });&#10;            }&#10;&#10;            var token = await jwtTokenService.GenerateTokenAsync(user);&#10;            var roles = await userManager.GetRolesAsync(user);&#10;&#10;            return Ok(new&#10;            {&#10;                Message = &quot;Giriş başarılı&quot;,&#10;                Token = token,&#10;                User = new&#10;                {&#10;                    user.Id,&#10;                    user.UserName,&#10;                    user.Email,&#10;                    Roles = roles&#10;                }&#10;            });&#10;        }&#10;&#10;        [HttpPost(&quot;ForgotPassword&quot;)]&#10;        public async Task&lt;IActionResult&gt; ForgotPassword(ForgotPasswordDto forgotPasswordDto)&#10;        {&#10;            var user = await userManager.FindByEmailAsync(forgotPasswordDto.Email);&#10;            if (user == null || !(await userManager.IsEmailConfirmedAsync(user)))&#10;            {&#10;                return Ok(new&#10;                {&#10;                    Message =&#10;                        &quot;Eğer bu e-posta adresine kayıtlı bir hesap varsa, şifre sıfırlama talimatları gönderildi.&quot;&#10;                });&#10;            }&#10;&#10;            var resetToken = await userManager.GeneratePasswordResetTokenAsync(user);&#10;&#10;            // Frontend URL'ini kullan&#10;            var frontendUrl = &quot;http://localhost:3000&quot;;&#10;            var resetLink = $&quot;{frontendUrl}/reset-password?userId={user.Id}&amp;token={Uri.EscapeDataString(resetToken)}&quot;;&#10;&#10;            try&#10;            {&#10;                await emailService.SendPasswordResetAsync(user.Email!, user.UserName!, resetLink);&#10;            }&#10;            catch (Exception ex)&#10;            {&#10;              &#10;                Console.WriteLine($&quot;Failed to send password reset email: {ex}&quot;);&#10;            }&#10;&#10;            return Ok(new&#10;            {&#10;                Message =&#10;                    &quot;Eğer bu e-posta adresine kayıtlı bir hesap varsa, şifre sıfırlama talimatları gönderildi.&quot;&#10;            });&#10;        }&#10;&#10;        [HttpPost(&quot;reset-password&quot;)]&#10;        public async Task&lt;IActionResult&gt; ResetPassword([FromBody] ResetPasswordDto resetPasswordDto)&#10;        {&#10;            if (!ModelState.IsValid)&#10;                return BadRequest(ModelState);&#10;&#10;            var user = await userManager.FindByIdAsync(resetPasswordDto.UserId);&#10;            if (user == null)&#10;            {&#10;                return BadRequest(new { Message = &quot;Geçersiz kullanıcı&quot; });&#10;            }&#10;&#10;            var isSamePassword = await userManager.CheckPasswordAsync(user, resetPasswordDto.Password);&#10;            if (isSamePassword)&#10;            {&#10;                return BadRequest(new { Message = &quot;Yeni şifre eskisiyle aynı olamaz.&quot; });&#10;            }&#10;&#10;            var result = await userManager.ResetPasswordAsync(user, resetPasswordDto.Token, resetPasswordDto.Password);&#10;            if (result.Succeeded)&#10;            {&#10;                return Ok(new { Message = &quot;Şifreniz başarıyla sıfırlandı&quot; });&#10;            }&#10;&#10;            return BadRequest(new { Message = &quot;Şifre sıfırlama başarısız. Linkin süresi dolmuş olabilir.&quot; });&#10;        }&#10;&#10;        [HttpPost(&quot;change-password&quot;)]&#10;        [Authorize]&#10;        public async Task&lt;IActionResult&gt; ChangePassword([FromBody] ChangePasswordDto changePasswordDto)&#10;        {&#10;            if (!ModelState.IsValid)&#10;                return BadRequest(ModelState);&#10;&#10;            var currentUser = await userManager.GetUserAsync(User);&#10;            if (currentUser == null)&#10;            {&#10;                return Redirect($&quot;{Request.Scheme}://{Request.Host.Host}:3000/login&quot;);&#10;            }&#10;&#10;       &#10;            var isCurrentPasswordCorrect = await userManager.CheckPasswordAsync(currentUser, changePasswordDto.CurrentPassword);&#10;            if (!isCurrentPasswordCorrect)&#10;            {&#10;                return BadRequest(new { Message = &quot;Mevcut şifreniz yanlış&quot; });&#10;            }&#10;&#10;        &#10;            var isSamePassword = await userManager.CheckPasswordAsync(currentUser, changePasswordDto.NewPassword);&#10;            if (isSamePassword)&#10;            {&#10;                return BadRequest(new { Message = &quot;Yeni şifre mevcut şifrenizle aynı olamaz&quot; });&#10;            }&#10;&#10;            // Şifreyi değiştir&#10;            var result = await userManager.ChangePasswordAsync(currentUser, changePasswordDto.CurrentPassword, changePasswordDto.NewPassword);&#10;            if (result.Succeeded)&#10;            {&#10;                return Ok(new { Message = &quot;Şifreniz başarıyla değiştirildi&quot; });&#10;            }&#10;&#10;            foreach (var error in result.Errors)&#10;            {&#10;                ModelState.AddModelError(error.Code, error.Description);&#10;            }&#10;&#10;            return BadRequest(ModelState);&#10;        }&#10;&#10;        [HttpGet(&quot;profile&quot;)]&#10;        [Authorize]&#10;        public async Task&lt;IActionResult&gt; GetUserProfile()&#10;        {&#10;            var currentUser = await userManager.GetUserAsync(User);&#10;            if (currentUser == null)&#10;            {&#10;                return Unauthorized(new { Message = &quot;Kullanıcı bulunamadı&quot; });&#10;            }&#10;&#10;            var roles = await userManager.GetRolesAsync(currentUser);&#10;&#10;            return Ok(new&#10;            {&#10;                currentUser.Id,&#10;                currentUser.FirstName,&#10;                currentUser.LastName,&#10;                currentUser.FullName,&#10;                currentUser.UserName,&#10;                currentUser.Email,&#10;                currentUser.EmailConfirmed,&#10;                currentUser.Phone,&#10;                currentUser.Address,&#10;                Roles = roles&#10;            });&#10;        }&#10;&#10;        [HttpPost(&quot;profile&quot;)]&#10;        [Authorize]&#10;        public async Task&lt;IActionResult&gt; UpdateUserProfile(UserProfileDto userProfileDto)&#10;        {&#10;            if (!ModelState.IsValid)&#10;                return BadRequest(ModelState);&#10;&#10;            var currentUser = await userManager.GetUserAsync(User);&#10;            if (currentUser == null)&#10;            {&#10;                return Unauthorized(new { Message = &quot;Kullanıcı bulunamadı&quot; });&#10;            }&#10;&#10;            bool emailChanged = false;&#10;&#10;            // İsim / soyisim güncelle&#10;            if (!string.IsNullOrWhiteSpace(userProfileDto.FirstName))&#10;            {&#10;                currentUser.FirstName = userProfileDto.FirstName.Trim();&#10;            }&#10;&#10;            if (!string.IsNullOrWhiteSpace(userProfileDto.LastName))&#10;            {&#10;                currentUser.LastName = userProfileDto.LastName.Trim();&#10;            }&#10;&#10;            // FullName'i sunucu tarafında birleştir&#10;            currentUser.FullName = $&quot;{currentUser.FirstName} {currentUser.LastName}&quot;.Trim();&#10;&#10;            // Username değişikliği ve benzersizlik kontrolü&#10;            if (!string.IsNullOrWhiteSpace(userProfileDto.UserName) &amp;&amp;&#10;                !string.Equals(currentUser.UserName, userProfileDto.UserName, StringComparison.OrdinalIgnoreCase))&#10;            {&#10;                var existingByUsername = await userManager.FindByNameAsync(userProfileDto.UserName);&#10;                if (existingByUsername != null &amp;&amp; existingByUsername.Id != currentUser.Id)&#10;                {&#10;                    ModelState.AddModelError(&quot;UserName&quot;, &quot;Bu kullanıcı adı zaten kullanılıyor&quot;);&#10;                    return BadRequest(ModelState);&#10;                }&#10;&#10;                currentUser.UserName = userProfileDto.UserName;&#10;            }&#10;&#10;            // Email değişikliği ve benzersizlik kontrolü&#10;            if (!string.IsNullOrWhiteSpace(userProfileDto.Email) &amp;&amp;&#10;                !string.Equals(currentUser.Email, userProfileDto.Email, StringComparison.OrdinalIgnoreCase))&#10;            {&#10;                var existingByEmail = await userManager.FindByEmailAsync(userProfileDto.Email);&#10;                if (existingByEmail != null &amp;&amp; existingByEmail.Id != currentUser.Id)&#10;                {&#10;                    ModelState.AddModelError(&quot;Email&quot;, &quot;Bu e-posta adresi zaten kullanılıyor&quot;);&#10;                    return BadRequest(ModelState);&#10;                }&#10;&#10;                currentUser.Email = userProfileDto.Email;&#10;                // E-posta değişince yeniden doğrulama gereksinimi&#10;                currentUser.EmailConfirmed = false;&#10;                emailChanged = true;&#10;            }&#10;&#10;            // Telefon ve adres güncelle&#10;            currentUser.Phone = userProfileDto.Phone ?? currentUser.Phone;&#10;            currentUser.Address = userProfileDto.Address ?? currentUser.Address;&#10;&#10;            var updateResult = await userManager.UpdateAsync(currentUser);&#10;            if (!updateResult.Succeeded)&#10;            {&#10;                foreach (var error in updateResult.Errors)&#10;                {&#10;                    ModelState.AddModelError(error.Code, error.Description);&#10;                }&#10;&#10;                return BadRequest(ModelState);&#10;            }&#10;&#10;            // Eğer e-posta değiştiyse doğrulama e-posta&#10;            if (emailChanged)&#10;            {&#10;                try&#10;                {&#10;                    var emailToken = await userManager.GenerateEmailConfirmationTokenAsync(currentUser);&#10;                    var verificationLink =&#10;                        $&quot;{Request.Scheme}://{Request.Host}/api/Account/verify-email?userId={currentUser.Id}&amp;token={Uri.EscapeDataString(emailToken)}&quot;;&#10;                    await emailService.SendEmailVerificationAsync(currentUser.Email!, currentUser.UserName!,&#10;                        verificationLink);&#10;                }&#10;                catch (Exception ex)&#10;                {&#10;                    return Ok(new&#10;                    {&#10;                        Message = &quot;Profil güncellendi ancak doğrulama e-postası gönderilemedi.&quot;,&#10;                        Error = ex.Message&#10;                    });&#10;                }&#10;&#10;                return Ok(new { Message = &quot;Profil güncellendi. Yeni e-posta adresinizi doğrulayın.&quot; });&#10;            }&#10;&#10;            return Ok(new { Message = &quot;Profil güncellendi.&quot; });&#10;        }&#10;        [HttpPost(&quot;request-account-deletion&quot;)]&#10;        [Authorize]&#10;        public async Task&lt;IActionResult&gt; RequestAccountDeletion()&#10;        {&#10;            var currentUser = await userManager.GetUserAsync(User);&#10;            if (currentUser == null)&#10;            {&#10;                return Unauthorized(new { Message = &quot;Kullanıcı bulunamadı&quot; });&#10;            }&#10;&#10;            // Token oluştur&#10;            var deletionToken = await userManager.GenerateUserTokenAsync(&#10;                currentUser,&#10;                TokenOptions.DefaultProvider,&#10;                &quot;AccountDeletion&quot;);&#10;&#10;            // E-posta ile onay linki gönder&#10;            var deletionLink = $&quot;{Request.Scheme}://{Request.Host}/api/Account/confirm-account-deletion?userId={currentUser.Id}&amp;token={Uri.EscapeDataString(deletionToken)}&quot;;&#10;&#10;            try&#10;            {&#10;                await emailService.SendAccountDeletionConfirmationAsync(&#10;                    currentUser.Email!,&#10;                    currentUser.UserName!,&#10;                    deletionLink);&#10;&#10;                return Ok(new { Message = &quot;Hesap silme onayı için e-posta adresinize bir link gönderdik. Lütfen e-postanızı kontrol edin.&quot; });&#10;            }&#10;            catch (Exception ex)&#10;            {&#10;                return StatusCode(500, new { Message = &quot;E-posta gönderilemedi&quot;, Error = ex.Message });&#10;            }&#10;        }&#10;&#10;        [HttpGet(&quot;confirm-account-deletion&quot;)]&#10;        public async Task&lt;IActionResult&gt; ConfirmAccountDeletion([FromQuery] string userId, [FromQuery] string token)&#10;        {&#10;            if (string.IsNullOrEmpty(userId) || string.IsNullOrEmpty(token))&#10;            {&#10;                return Redirect($&quot;{Request.Scheme}://{Request.Host.Host}:3000/account-deleted?status=invalid&quot;);&#10;            }&#10;&#10;            var user = await userManager.FindByIdAsync(userId);&#10;            if (user == null)&#10;            {&#10;                return Redirect($&quot;{Request.Scheme}://{Request.Host.Host}:3000/account-deleted?status=not-found&quot;);&#10;            }&#10;&#10;            // Token'ı doğrula&#10;            var isValidToken = await userManager.VerifyUserTokenAsync(&#10;                user,&#10;                TokenOptions.DefaultProvider,&#10;                &quot;AccountDeletion&quot;,&#10;                token);&#10;&#10;            if (!isValidToken)&#10;            {&#10;                return Redirect($&quot;{Request.Scheme}://{Request.Host.Host}:3000/account-deleted?status=invalid-token&quot;);&#10;            }&#10;&#10;            // Hesabı sil (soft delete)&#10;            user.IsDeleted = true;&#10;            var result = await userManager.UpdateAsync(user);&#10;&#10;            if (result.Succeeded)&#10;            {&#10;                return Redirect($&quot;{Request.Scheme}://{Request.Host.Host}:3000/account-deleted?status=success&quot;);&#10;            }&#10;&#10;            return Redirect($&quot;{Request.Scheme}://{Request.Host.Host}:3000/account-deleted?status=failed&quot;);&#10;        }&#10;&#10;        [HttpPost(&quot;delete-account&quot;)]&#10;        [Authorize]&#10;        public async Task&lt;IActionResult&gt; DeleteAccount()&#10;        {&#10;            // Bu endpoint artık kullanılmıyor, yeni endpoint: request-account-deletion&#10;            return BadRequest(new { Message = &quot;Bu endpoint kullanım dışı. Lütfen 'request-account-deletion' kullanın.&quot; });&#10;        }&#10;&#10;&#10;        [HttpPost(&quot;logout&quot;)]&#10;        [Authorize]&#10;        public async Task&lt;IActionResult&gt; Logout()&#10;        {&#10;            await signInManager.SignOutAsync();&#10;            return Ok(new { Message = &quot;Çıkış başarılı&quot; });&#10;        }&#10;        [HttpPost(&quot;restaurant-ownership-application&quot;)]&#10;        [Authorize]&#10;        public async Task&lt;IActionResult&gt; ApplyForRestaurantOwnership([FromBody] OwnershipApplicationDto applicationDto)&#10;        {&#10;            var currentUser = await userManager.GetUserAsync(User);&#10;            if (currentUser == null)&#10;            {&#10;                return Unauthorized(new { Message = &quot;Kullanıcı bulunamadı&quot; });&#10;            }&#10;&#10;            // Kullanıcının bekleyen bir başvurusu var mı kontrol et&#10;            var hasPendingApplication = userManager.Users&#10;                .Where(u =&gt; u.Id == currentUser.Id)&#10;                .SelectMany(u =&gt; u.OwnershipApplications)&#10;                .Any(a =&gt; a.Status == ApplicationStatus.Pending);&#10;&#10;            if (hasPendingApplication)&#10;            {&#10;                return BadRequest(new { Message = &quot;Zaten bekleyen bir başvurunuz var.&quot; });&#10;            }&#10;&#10;            var application = new OwnershipApplication&#10;            {&#10;                UserId = currentUser.Id,&#10;                BusinessName = applicationDto.BusinessName,&#10;                BusinessDescription = applicationDto.BusinessDescription,&#10;                BusinessAddress = applicationDto.BusinessAddress,&#10;                BusinessPhone = applicationDto.BusinessPhone,&#10;                BusinessEmail = applicationDto.BusinessEmail,&#10;                Category = applicationDto.Category,&#10;                AdditionalNotes = applicationDto.AdditionalNotes,&#10;                ApplicationDate = DateTime.UtcNow,&#10;                Status = ApplicationStatus.Pending&#10;            };&#10;&#10;            await accountService.CreateApplicationAsync(application);&#10;&#10;            return Ok(new { Message = &quot;Restoran sahipliği başvurunuz alındı ve incelenecektir.&quot; });&#10;        }&#10;       &#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="using AutoMapper;&#10;using Microsoft.AspNetCore.Authorization;&#10;using Microsoft.AspNetCore.Identity;&#10;using Microsoft.AspNetCore.Mvc;&#10;using RestaurantManagment.Application.Common.DTOs.Account;&#10;using RestaurantManagment.Application.Common.Interfaces;&#10;using RestaurantManagment.Domain.Models;&#10;using RestaurantManagment.Infrastructure.Services;&#10;&#10;namespace RestaurantManagment.WebAPI.Controllers&#10;{&#10;    [Route(&quot;api/[controller]&quot;)]&#10;    [ApiController]&#10;    public class AccountController(&#10;        UserManager&lt;AppUser&gt; userManager,&#10;        SignInManager&lt;AppUser&gt; signInManager,&#10;        IMapper mapper,&#10;        IEmailService emailService,&#10;        IJwtTokenService jwtTokenService,&#10;        IAccountService accountService) : Controller&#10;    {&#10;        private readonly IAccountService _accountService = accountService;&#10;        &#10;        [HttpPost(&quot;register&quot;)]&#10;        public async Task&lt;IActionResult&gt; Register(UserRegisterDto userRegisterDto)&#10;        {&#10;            if (!ModelState.IsValid)&#10;                return BadRequest(ModelState);&#10;            &#10;            var existingUserByUsername = await userManager.FindByNameAsync(userRegisterDto.Username);&#10;            if (existingUserByUsername != null)&#10;            {&#10;                ModelState.AddModelError(&quot;Username&quot;, &quot;Bu kullanıcı adı zaten kullanılıyor&quot;);&#10;                return BadRequest(ModelState);&#10;            }&#10;            &#10;            &#10;            var existingUserByEmail = await userManager.FindByEmailAsync(userRegisterDto.Email);&#10;            if (existingUserByEmail != null)&#10;            {&#10;                if (existingUserByEmail.IsDeleted)&#10;                {&#10;                    ModelState.AddModelError(&quot;Email&quot;, &quot;Bu e-posta adresi silinmiş bir hesaba ait. Lütfen farklı bir e-posta kullanın veya destek ile iletişime geçin,Veya hesabınızı geri yükleyin.&quot;);&#10;                    return BadRequest(ModelState);&#10;                }&#10;                ModelState.AddModelError(&quot;Email&quot;, &quot;Bu e-posta adresi zaten kullanılıyor&quot;);&#10;                return BadRequest(ModelState);&#10;            }&#10;&#10;            var user = mapper.Map&lt;AppUser&gt;(userRegisterDto);&#10;&#10;            var result = await userManager.CreateAsync(user, userRegisterDto.Password);&#10;            if (!result.Succeeded)&#10;            {&#10;                foreach (var error in result.Errors)&#10;                {&#10;                    ModelState.AddModelError(error.Code, error.Description);&#10;                }&#10;&#10;                return BadRequest(ModelState);&#10;            }&#10;&#10;            await userManager.AddToRoleAsync(user, &quot;Customer&quot;);&#10;&#10;           &#10;            var emailToken = await userManager.GenerateEmailConfirmationTokenAsync(user);&#10;&#10;            &#10;            var verificationLink =&#10;                $&quot;{Request.Scheme}://{Request.Host}/api/Account/verify-email?userId={user.Id}&amp;token={Uri.EscapeDataString(emailToken)}&quot;;&#10;&#10;            try&#10;            {&#10;                await emailService.SendEmailVerificationAsync(user.Email!, user.UserName!, verificationLink);&#10;            }&#10;            catch (Exception ex)&#10;            {&#10;              &#10;                return Ok(new&#10;                {&#10;                    Message = &quot;Kayıt başarılı ancak doğrulama e-postası gönderilemedi. Lütfen tekrar deneyin.&quot;,&#10;                    UserId = user.Id,&#10;                    EmailSendError = ex.Message&#10;                });&#10;            }&#10;&#10;            return Ok(new&#10;            {&#10;                Message = &quot;Kayıt başarılı! Lütfen e-posta adresinizi kontrol edin ve hesabınızı doğrulayın.&quot;,&#10;                UserId = user.Id,&#10;                Email = user.Email&#10;            });&#10;        }&#10;&#10;        [HttpGet(&quot;verify-email&quot;)]&#10;        public async Task&lt;IActionResult&gt; VerifyEmail([FromQuery] string userId, [FromQuery] string token)&#10;        {&#10;            if (string.IsNullOrEmpty(userId) || string.IsNullOrEmpty(token))&#10;            {&#10;                return BadRequest(new { Message = &quot;Geçersiz doğrulama linki&quot; });&#10;            }&#10;&#10;            var user = await userManager.FindByIdAsync(userId);&#10;            if (user == null)&#10;            {&#10;                return NotFound(new { Message = &quot;Kullanıcı bulunamadı&quot; });&#10;            }&#10;&#10;            if (user.EmailConfirmed)&#10;            {&#10;                return Redirect($&quot;{Request.Scheme}://{Request.Host.Host}:3000/email-verified?status=already-verified&quot;);&#10;            }&#10;&#10;            var result = await userManager.ConfirmEmailAsync(user, token);&#10;            if (result.Succeeded)&#10;            {&#10;              &#10;                return Redirect($&quot;{Request.Scheme}://{Request.Host.Host}:3000/email-verified?status=success&quot;);&#10;            }&#10;            else&#10;            {&#10;                return Redirect($&quot;{Request.Scheme}://{Request.Host.Host}:3000/email-verified?status=failed&quot;);&#10;            }&#10;        }&#10;&#10;        [HttpPost(&quot;resend-verification&quot;)]&#10;        public async Task&lt;IActionResult&gt; ResendVerificationEmail([FromBody] ResendVerificationDto dto)&#10;        {&#10;            var user = await userManager.FindByEmailAsync(dto.Email);&#10;            if (user == null)&#10;            {&#10;                return NotFound(new { Message = &quot;Kullanıcı bulunamadı&quot; });&#10;            }&#10;&#10;            if (user.EmailConfirmed)&#10;            {&#10;                return BadRequest(new { Message = &quot;E-posta adresi zaten doğrulanmış&quot; });&#10;            }&#10;&#10;            var emailToken = await userManager.GenerateEmailConfirmationTokenAsync(user);&#10;            var verificationLink =&#10;                $&quot;{Request.Scheme}://{Request.Host}/api/Account/verify-email?userId={user.Id}&amp;token={Uri.EscapeDataString(emailToken)}&quot;;&#10;&#10;            try&#10;            {&#10;                await emailService.SendEmailVerificationAsync(user.Email!, user.UserName!, verificationLink);&#10;                return Ok(new { Message = &quot;Doğrulama e-postası tekrar gönderildi&quot; });&#10;            }&#10;            catch (Exception ex)&#10;            {&#10;                return StatusCode(500, new { Message = &quot;E-posta gönderilemedi&quot;, Error = ex.Message });&#10;            }&#10;        }&#10;&#10;        [HttpPost(&quot;login&quot;)]&#10;        public async Task&lt;IActionResult&gt; Login(UserLoginDto userLoginDto)&#10;        {&#10;            if (!ModelState.IsValid)&#10;                return BadRequest(ModelState);&#10;&#10;            var user = await userManager.FindByEmailAsync(userLoginDto.Email);&#10;            if (user == null)&#10;            {&#10;                return Unauthorized(new { Message = &quot;Geçersiz e-posta veya şifre&quot; });&#10;            }&#10;            &#10;&#10;&#10;            if (!user.EmailConfirmed)&#10;            {&#10;                return Unauthorized(new&#10;                {&#10;                    Message = &quot;Lütfen önce e-posta adresinizi doğrulayın&quot;,&#10;                    RequiresEmailVerification = true,&#10;                    Email = user.Email&#10;                });&#10;            }&#10;&#10;            var result = await signInManager.CheckPasswordSignInAsync(user, userLoginDto.Password, false);&#10;            if (!result.Succeeded)&#10;            {&#10;                return Unauthorized(new { Message = &quot;Geçersiz e-posta veya şifre&quot; });&#10;            }&#10;&#10;            var token = await jwtTokenService.GenerateTokenAsync(user);&#10;            var roles = await userManager.GetRolesAsync(user);&#10;&#10;            return Ok(new&#10;            {&#10;                Message = &quot;Giriş başarılı&quot;,&#10;                Token = token,&#10;                User = new&#10;                {&#10;                    user.Id,&#10;                    user.UserName,&#10;                    user.Email,&#10;                    Roles = roles&#10;                }&#10;            });&#10;        }&#10;&#10;        [HttpPost(&quot;ForgotPassword&quot;)]&#10;        public async Task&lt;IActionResult&gt; ForgotPassword(ForgotPasswordDto forgotPasswordDto)&#10;        {&#10;            var user = await userManager.FindByEmailAsync(forgotPasswordDto.Email);&#10;            if (user == null || !(await userManager.IsEmailConfirmedAsync(user)))&#10;            {&#10;                return Ok(new&#10;                {&#10;                    Message =&#10;                        &quot;Eğer bu e-posta adresine kayıtlı bir hesap varsa, şifre sıfırlama talimatları gönderildi.&quot;&#10;                });&#10;            }&#10;&#10;            var resetToken = await userManager.GeneratePasswordResetTokenAsync(user);&#10;&#10;            // Frontend URL'ini kullan&#10;            var frontendUrl = &quot;http://localhost:3000&quot;;&#10;            var resetLink = $&quot;{frontendUrl}/reset-password?userId={user.Id}&amp;token={Uri.EscapeDataString(resetToken)}&quot;;&#10;&#10;            try&#10;            {&#10;                await emailService.SendPasswordResetAsync(user.Email!, user.UserName!, resetLink);&#10;            }&#10;            catch (Exception ex)&#10;            {&#10;              &#10;                Console.WriteLine($&quot;Failed to send password reset email: {ex}&quot;);&#10;            }&#10;&#10;            return Ok(new&#10;            {&#10;                Message =&#10;                    &quot;Eğer bu e-posta adresine kayıtlı bir hesap varsa, şifre sıfırlama talimatları gönderildi.&quot;&#10;            });&#10;        }&#10;&#10;        [HttpPost(&quot;reset-password&quot;)]&#10;        public async Task&lt;IActionResult&gt; ResetPassword([FromBody] ResetPasswordDto resetPasswordDto)&#10;        {&#10;            if (!ModelState.IsValid)&#10;                return BadRequest(ModelState);&#10;&#10;            var user = await userManager.FindByIdAsync(resetPasswordDto.UserId);&#10;            if (user == null)&#10;            {&#10;                return BadRequest(new { Message = &quot;Geçersiz kullanıcı&quot; });&#10;            }&#10;&#10;            var isSamePassword = await userManager.CheckPasswordAsync(user, resetPasswordDto.Password);&#10;            if (isSamePassword)&#10;            {&#10;                return BadRequest(new { Message = &quot;Yeni şifre eskisiyle aynı olamaz.&quot; });&#10;            }&#10;&#10;            var result = await userManager.ResetPasswordAsync(user, resetPasswordDto.Token, resetPasswordDto.Password);&#10;            if (result.Succeeded)&#10;            {&#10;                return Ok(new { Message = &quot;Şifreniz başarıyla sıfırlandı&quot; });&#10;            }&#10;&#10;            return BadRequest(new { Message = &quot;Şifre sıfırlama başarısız. Linkin süresi dolmuş olabilir.&quot; });&#10;        }&#10;&#10;        [HttpPost(&quot;change-password&quot;)]&#10;        [Authorize]&#10;        public async Task&lt;IActionResult&gt; ChangePassword([FromBody] ChangePasswordDto changePasswordDto)&#10;        {&#10;            if (!ModelState.IsValid)&#10;                return BadRequest(ModelState);&#10;&#10;            var currentUser = await userManager.GetUserAsync(User);&#10;            if (currentUser == null)&#10;            {&#10;                return Redirect($&quot;{Request.Scheme}://{Request.Host.Host}:3000/login&quot;);&#10;            }&#10;&#10;       &#10;            var isCurrentPasswordCorrect = await userManager.CheckPasswordAsync(currentUser, changePasswordDto.CurrentPassword);&#10;            if (!isCurrentPasswordCorrect)&#10;            {&#10;                return BadRequest(new { Message = &quot;Mevcut şifreniz yanlış&quot; });&#10;            }&#10;&#10;        &#10;            var isSamePassword = await userManager.CheckPasswordAsync(currentUser, changePasswordDto.NewPassword);&#10;            if (isSamePassword)&#10;            {&#10;                return BadRequest(new { Message = &quot;Yeni şifre mevcut şifrenizle aynı olamaz&quot; });&#10;            }&#10;&#10;            // Şifreyi değiştir&#10;            var result = await userManager.ChangePasswordAsync(currentUser, changePasswordDto.CurrentPassword, changePasswordDto.NewPassword);&#10;            if (result.Succeeded)&#10;            {&#10;                return Ok(new { Message = &quot;Şifreniz başarıyla değiştirildi&quot; });&#10;            }&#10;&#10;            foreach (var error in result.Errors)&#10;            {&#10;                ModelState.AddModelError(error.Code, error.Description);&#10;            }&#10;&#10;            return BadRequest(ModelState);&#10;        }&#10;&#10;        [HttpGet(&quot;profile&quot;)]&#10;        [Authorize]&#10;        public async Task&lt;IActionResult&gt; GetUserProfile()&#10;        {&#10;            var currentUser = await userManager.GetUserAsync(User);&#10;            if (currentUser == null)&#10;            {&#10;                return Unauthorized(new { Message = &quot;Kullanıcı bulunamadı&quot; });&#10;            }&#10;&#10;            var roles = await userManager.GetRolesAsync(currentUser);&#10;&#10;            return Ok(new&#10;            {&#10;                currentUser.Id,&#10;                currentUser.FirstName,&#10;                currentUser.LastName,&#10;                currentUser.FullName,&#10;                currentUser.UserName,&#10;                currentUser.Email,&#10;                currentUser.EmailConfirmed,&#10;                currentUser.Phone,&#10;                currentUser.Address,&#10;                Roles = roles&#10;            });&#10;        }&#10;&#10;        [HttpPost(&quot;profile&quot;)]&#10;        [Authorize]&#10;        public async Task&lt;IActionResult&gt; UpdateUserProfile(UserProfileDto userProfileDto)&#10;        {&#10;            if (!ModelState.IsValid)&#10;                return BadRequest(ModelState);&#10;&#10;            var currentUser = await userManager.GetUserAsync(User);&#10;            if (currentUser == null)&#10;            {&#10;                return Unauthorized(new { Message = &quot;Kullanıcı bulunamadı&quot; });&#10;            }&#10;&#10;            bool emailChanged = false;&#10;&#10;            // İsim / soyisim güncelle&#10;            if (!string.IsNullOrWhiteSpace(userProfileDto.FirstName))&#10;            {&#10;                currentUser.FirstName = userProfileDto.FirstName.Trim();&#10;            }&#10;&#10;            if (!string.IsNullOrWhiteSpace(userProfileDto.LastName))&#10;            {&#10;                currentUser.LastName = userProfileDto.LastName.Trim();&#10;            }&#10;&#10;            // FullName'i sunucu tarafında birleştir&#10;            currentUser.FullName = $&quot;{currentUser.FirstName} {currentUser.LastName}&quot;.Trim();&#10;&#10;            // Username değişikliği ve benzersizlik kontrolü&#10;            if (!string.IsNullOrWhiteSpace(userProfileDto.UserName) &amp;&amp;&#10;                !string.Equals(currentUser.UserName, userProfileDto.UserName, StringComparison.OrdinalIgnoreCase))&#10;            {&#10;                var existingByUsername = await userManager.FindByNameAsync(userProfileDto.UserName);&#10;                if (existingByUsername != null &amp;&amp; existingByUsername.Id != currentUser.Id)&#10;                {&#10;                    ModelState.AddModelError(&quot;UserName&quot;, &quot;Bu kullanıcı adı zaten kullanılıyor&quot;);&#10;                    return BadRequest(ModelState);&#10;                }&#10;&#10;                currentUser.UserName = userProfileDto.UserName;&#10;            }&#10;&#10;            // Email değişikliği ve benzersizlik kontrolü&#10;            if (!string.IsNullOrWhiteSpace(userProfileDto.Email) &amp;&amp;&#10;                !string.Equals(currentUser.Email, userProfileDto.Email, StringComparison.OrdinalIgnoreCase))&#10;            {&#10;                var existingByEmail = await userManager.FindByEmailAsync(userProfileDto.Email);&#10;                if (existingByEmail != null &amp;&amp; existingByEmail.Id != currentUser.Id)&#10;                {&#10;                    ModelState.AddModelError(&quot;Email&quot;, &quot;Bu e-posta adresi zaten kullanılıyor&quot;);&#10;                    return BadRequest(ModelState);&#10;                }&#10;&#10;                currentUser.Email = userProfileDto.Email;&#10;                // E-posta değişince yeniden doğrulama gereksinimi&#10;                currentUser.EmailConfirmed = false;&#10;                emailChanged = true;&#10;            }&#10;&#10;            // Telefon ve adres güncelle&#10;            currentUser.Phone = userProfileDto.Phone ?? currentUser.Phone;&#10;            currentUser.Address = userProfileDto.Address ?? currentUser.Address;&#10;&#10;            var updateResult = await userManager.UpdateAsync(currentUser);&#10;            if (!updateResult.Succeeded)&#10;            {&#10;                foreach (var error in updateResult.Errors)&#10;                {&#10;                    ModelState.AddModelError(error.Code, error.Description);&#10;                }&#10;&#10;                return BadRequest(ModelState);&#10;            }&#10;&#10;            // Eğer e-posta değiştiyse doğrulama e-posta&#10;            if (emailChanged)&#10;            {&#10;                try&#10;                {&#10;                    var emailToken = await userManager.GenerateEmailConfirmationTokenAsync(currentUser);&#10;                    var verificationLink =&#10;                        $&quot;{Request.Scheme}://{Request.Host}/api/Account/verify-email?userId={currentUser.Id}&amp;token={Uri.EscapeDataString(emailToken)}&quot;;&#10;                    await emailService.SendEmailVerificationAsync(currentUser.Email!, currentUser.UserName!,&#10;                        verificationLink);&#10;                }&#10;                catch (Exception ex)&#10;                {&#10;                    return Ok(new&#10;                    {&#10;                        Message = &quot;Profil güncellendi ancak doğrulama e-postası gönderilemedi.&quot;,&#10;                        Error = ex.Message&#10;                    });&#10;                }&#10;&#10;                return Ok(new { Message = &quot;Profil güncellendi. Yeni e-posta adresinizi doğrulayın.&quot; });&#10;            }&#10;&#10;            return Ok(new { Message = &quot;Profil güncellendi.&quot; });&#10;        }&#10;        [HttpPost(&quot;request-account-deletion&quot;)]&#10;        [Authorize]&#10;        public async Task&lt;IActionResult&gt; RequestAccountDeletion()&#10;        {&#10;            var currentUser = await userManager.GetUserAsync(User);&#10;            if (currentUser == null)&#10;            {&#10;                return Unauthorized(new { Message = &quot;Kullanıcı bulunamadı&quot; });&#10;            }&#10;&#10;            // Token oluştur&#10;            var deletionToken = await userManager.GenerateUserTokenAsync(&#10;                currentUser,&#10;                TokenOptions.DefaultProvider,&#10;                &quot;AccountDeletion&quot;);&#10;&#10;            // E-posta ile onay linki gönder&#10;            var deletionLink = $&quot;{Request.Scheme}://{Request.Host}/api/Account/confirm-account-deletion?userId={currentUser.Id}&amp;token={Uri.EscapeDataString(deletionToken)}&quot;;&#10;&#10;            try&#10;            {&#10;                await emailService.SendAccountDeletionConfirmationAsync(&#10;                    currentUser.Email!,&#10;                    currentUser.UserName!,&#10;                    deletionLink);&#10;&#10;                return Ok(new { Message = &quot;Hesap silme onayı için e-posta adresinize bir link gönderdik. Lütfen e-postanızı kontrol edin.&quot; });&#10;            }&#10;            catch (Exception ex)&#10;            {&#10;                return StatusCode(500, new { Message = &quot;E-posta gönderilemedi&quot;, Error = ex.Message });&#10;            }&#10;        }&#10;&#10;        [HttpGet(&quot;confirm-account-deletion&quot;)]&#10;        public async Task&lt;IActionResult&gt; ConfirmAccountDeletion([FromQuery] string userId, [FromQuery] string token)&#10;        {&#10;            if (string.IsNullOrEmpty(userId) || string.IsNullOrEmpty(token))&#10;            {&#10;                return Redirect($&quot;{Request.Scheme}://{Request.Host.Host}:3000/account-deleted?status=invalid&quot;);&#10;            }&#10;&#10;            var user = await userManager.FindByIdAsync(userId);&#10;            if (user == null)&#10;            {&#10;                return Redirect($&quot;{Request.Scheme}://{Request.Host.Host}:3000/account-deleted?status=not-found&quot;);&#10;            }&#10;&#10;            // Token'ı doğrula&#10;            var isValidToken = await userManager.VerifyUserTokenAsync(&#10;                user,&#10;                TokenOptions.DefaultProvider,&#10;                &quot;AccountDeletion&quot;,&#10;                token);&#10;&#10;            if (!isValidToken)&#10;            {&#10;                return Redirect($&quot;{Request.Scheme}://{Request.Host.Host}:3000/account-deleted?status=invalid-token&quot;);&#10;            }&#10;&#10;            // Hesabı sil (soft delete)&#10;            user.IsDeleted = true;&#10;            var result = await userManager.UpdateAsync(user);&#10;&#10;            if (result.Succeeded)&#10;            {&#10;                return Redirect($&quot;{Request.Scheme}://{Request.Host.Host}:3000/account-deleted?status=success&quot;);&#10;            }&#10;&#10;            return Redirect($&quot;{Request.Scheme}://{Request.Host.Host}:3000/account-deleted?status=failed&quot;);&#10;        }&#10;&#10;        [HttpPost(&quot;delete-account&quot;)]&#10;        [Authorize]&#10;        public async Task&lt;IActionResult&gt; DeleteAccount()&#10;        {&#10;            // Bu endpoint artık kullanılmıyor, yeni endpoint: request-account-deletion&#10;            return BadRequest(new { Message = &quot;Bu endpoint kullanım dışı. Lütfen 'request-account-deletion' kullanın.&quot; });&#10;        }&#10;&#10;&#10;        [HttpPost(&quot;logout&quot;)]&#10;        [Authorize]&#10;        public async Task&lt;IActionResult&gt; Logout()&#10;        {&#10;            await signInManager.SignOutAsync();&#10;            return Ok(new { Message = &quot;Çıkış başarılı&quot; });&#10;        }&#10;        [HttpPost(&quot;restaurant-ownership-application&quot;)]&#10;        [Authorize]&#10;        public async Task&lt;IActionResult&gt; ApplyForRestaurantOwnership([FromBody] OwnershipApplicationDto applicationDto)&#10;        {&#10;            var currentUser = await userManager.GetUserAsync(User);&#10;            if (currentUser == null)&#10;            {&#10;                return Unauthorized(new { Message = &quot;Kullanıcı bulunamadı&quot; });&#10;            }&#10;&#10;            // Kullanıcının bekleyen bir başvurusu var mı kontrol et&#10;            var hasPendingApplication = userManager.Users&#10;                .Where(u =&gt; u.Id == currentUser.Id)&#10;                .SelectMany(u =&gt; u.OwnershipApplications)&#10;                .Any(a =&gt; a.Status == ApplicationStatus.Pending);&#10;&#10;            if (hasPendingApplication)&#10;            {&#10;                return BadRequest(new { Message = &quot;Zaten bekleyen bir başvurunuz var.&quot; });&#10;            }&#10;&#10;            var application = new OwnershipApplication&#10;            {&#10;                UserId = currentUser.Id,&#10;                BusinessName = applicationDto.BusinessName,&#10;                BusinessDescription = applicationDto.BusinessDescription,&#10;                BusinessAddress = applicationDto.BusinessAddress,&#10;                BusinessPhone = applicationDto.BusinessPhone,&#10;                BusinessEmail = applicationDto.BusinessEmail,&#10;                Category = applicationDto.Category,&#10;                AdditionalNotes = applicationDto.AdditionalNotes,&#10;                ApplicationDate = DateTime.UtcNow,&#10;                Status = ApplicationStatus.Pending&#10;            };&#10;&#10;            await _accountService.CreateApplicationAsync(application);&#10;&#10;            return Ok(new { Message = &quot;Restoran sahipliği başvurunuz alındı ve incelenecektir.&quot; });&#10;        }&#10;       &#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/Src/Presentation/RestaurantManagment.WebAPI/Program.cs">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/Src/Presentation/RestaurantManagment.WebAPI/Program.cs" />
              <option name="originalContent" value="using System.Text;&#10;using Microsoft.AspNetCore.Authentication.JwtBearer;&#10;using Microsoft.AspNetCore.Identity;&#10;using Microsoft.IdentityModel.Tokens;&#10;using RestaurantManagment.Application;&#10;using RestaurantManagment.Domain.Models;&#10;using RestaurantManagment.Persistance;&#10;using RestaurantManagment.Persistance.Data;&#10;using RestaurantManagment.Infrastructure;&#10;&#10;namespace RestaurantManagment.WebAPI;&#10;public class Program&#10;{&#10;    public static async Task Main(string[] args)&#10;    {&#10;        var builder = WebApplication.CreateBuilder(args);&#10;&#10;        // Add services to the container.&#10;        builder.Services.AddControllers();&#10;        // Learn more about configuring OpenAPI at https://aka.ms/aspnet/openapi&#10;        builder.Services.AddOpenApi();&#10;        builder.Services.AddSwaggerGen(c =&gt;&#10;        {&#10;            c.SwaggerDoc(&quot;v1&quot;, new Microsoft.OpenApi.Models.OpenApiInfo { Title = &quot;RestaurantManagment API&quot;, Version = &quot;v1&quot; });&#10;            c.AddSecurityDefinition(&quot;Bearer&quot;, new Microsoft.OpenApi.Models.OpenApiSecurityScheme&#10;            {&#10;                Description = &quot;JWT Authorization header using the Bearer scheme.\r\n\r\n Enter 'Bearer' [space] and then your token in the text input below.\r\n\r\nExample: 'Bearer 12345abcdef'&quot;,&#10;                Name = &quot;Authorization&quot;,&#10;                In = Microsoft.OpenApi.Models.ParameterLocation.Header,&#10;                Type = Microsoft.OpenApi.Models.SecuritySchemeType.Http,&#10;                Scheme = &quot;bearer&quot;,&#10;                BearerFormat = &quot;JWT&quot;&#10;            });&#10;            c.AddSecurityRequirement(new Microsoft.OpenApi.Models.OpenApiSecurityRequirement&#10;            {&#10;                {&#10;                    new Microsoft.OpenApi.Models.OpenApiSecurityScheme&#10;                    {&#10;                        Reference = new Microsoft.OpenApi.Models.OpenApiReference&#10;                        {&#10;                            Type = Microsoft.OpenApi.Models.ReferenceType.SecurityScheme,&#10;                            Id = &quot;Bearer&quot;&#10;                        }&#10;                    },&#10;                    new string[] {}&#10;                }&#10;            });&#10;        });&#10;        &#10;        // Application Layer&#10;        builder.Services.AddApplication();&#10;        &#10;        // Persistence Layer&#10;        builder.Services.AddPersistance(builder.Configuration);&#10;        &#10;        // Infrastructure Layer&#10;        builder.Services.AddInfrastructure();&#10;        &#10;        // Identity&#10;        builder.Services.AddIdentity&lt;AppUser, IdentityRole&gt;(opt =&gt;&#10;        {&#10;            opt.Password.RequireDigit = true;&#10;            opt.Password.RequireLowercase = true;&#10;            opt.Password.RequireUppercase = true;&#10;            opt.Password.RequireNonAlphanumeric = false;&#10;            opt.User.RequireUniqueEmail = true;&#10;            opt.Lockout.MaxFailedAccessAttempts = 5;&#10;            opt.Lockout.AllowedForNewUsers = true;&#10;            opt.Lockout.DefaultLockoutTimeSpan = TimeSpan.FromMinutes(5);&#10;            opt.SignIn.RequireConfirmedEmail = true;&#10;            opt.Password.RequiredLength = 6;&#10;        }).AddEntityFrameworkStores&lt;AppDbContext&gt;()&#10;          .AddDefaultTokenProviders();&#10;&#10;        // JWT Authentication&#10;        var jwtSettings = builder.Configuration.GetSection(&quot;JwtSettings&quot;);&#10;        var secretKey = jwtSettings[&quot;SecretKey&quot;] ?? throw new InvalidOperationException(&quot;JWT SecretKey not configured&quot;);&#10;        &#10;        builder.Services.AddAuthentication(options =&gt;&#10;        {&#10;            options.DefaultAuthenticateScheme = JwtBearerDefaults.AuthenticationScheme;&#10;            options.DefaultChallengeScheme = JwtBearerDefaults.AuthenticationScheme;&#10;        })&#10;        .AddJwtBearer(options =&gt;&#10;        {&#10;            options.TokenValidationParameters = new TokenValidationParameters&#10;            {&#10;                ValidateIssuer = true,&#10;                ValidateAudience = true,&#10;                ValidateLifetime = true,&#10;                ValidateIssuerSigningKey = true,&#10;                ValidIssuer = jwtSettings[&quot;Issuer&quot;],&#10;                ValidAudience = jwtSettings[&quot;Audience&quot;],&#10;                IssuerSigningKey = new SymmetricSecurityKey(Encoding.UTF8.GetBytes(secretKey)),&#10;                ClockSkew = TimeSpan.Zero&#10;            };&#10;        });&#10;&#10;        builder.Services.AddAuthorization();&#10;&#10;        // CORS&#10;        builder.Services.AddCors(options =&gt;&#10;        {&#10;            options.AddPolicy(&quot;AllowAll&quot;, policy =&gt;&#10;            {&#10;                policy.AllowAnyOrigin()&#10;                      .AllowAnyMethod()&#10;                      .AllowAnyHeader();&#10;            });&#10;        });&#10;&#10;        var app = builder.Build();&#10;&#10;       &#10;        // Configure the HTTP request pipeline.&#10;        app.UseSwagger();&#10;        app.UseSwaggerUI(c =&gt;&#10;        {&#10;            c.SwaggerEndpoint(&quot;/swagger/v1/swagger.json&quot;, &quot;RestaurantManagment API V1&quot;);&#10;            c.RoutePrefix = &quot;swagger&quot;;&#10;            c.DocumentTitle = &quot;RestaurantManagment Swagger&quot;;&#10;            c.EnablePersistAuthorization(); // Bearer token için&#10;        });&#10;        app.MapOpenApi();&#10;&#10;        app.UseCors(&quot;AllowAll&quot;);&#10;        app.UseHttpsRedirection();&#10;        app.UseAuthentication();&#10;        app.UseAuthorization();&#10;        app.MapControllers();&#10;&#10;        app.Run();&#10;    }&#10;}" />
              <option name="updatedContent" value="using System.Text;&#10;using Microsoft.AspNetCore.Authentication.JwtBearer;&#10;using Microsoft.AspNetCore.Identity;&#10;using Microsoft.IdentityModel.Tokens;&#10;using RestaurantManagment.Application;&#10;using RestaurantManagment.Domain.Models;&#10;using RestaurantManagment.Persistance;&#10;using RestaurantManagment.Persistance.Data;&#10;using RestaurantManagment.Infrastructure;&#10;&#10;namespace RestaurantManagment.WebAPI;&#10;public class Program&#10;{&#10;    public static async Task Main(string[] args)&#10;    {&#10;        var builder = WebApplication.CreateBuilder(args);&#10;&#10;        // Add services to the container.&#10;        builder.Services.AddControllers();&#10;        // Learn more about configuring OpenAPI at https://aka.ms/aspnet/openapi&#10;        builder.Services.AddOpenApi();&#10;        builder.Services.AddSwaggerGen(c =&gt;&#10;        {&#10;            c.SwaggerDoc(&quot;v1&quot;, new Microsoft.OpenApi.Models.OpenApiInfo { Title = &quot;RestaurantManagment API&quot;, Version = &quot;v1&quot; });&#10;            c.AddSecurityDefinition(&quot;Bearer&quot;, new Microsoft.OpenApi.Models.OpenApiSecurityScheme&#10;            {&#10;                Description = &quot;JWT Authorization header using the Bearer scheme.\r\n\r\n Enter 'Bearer' [space] and then your token in the text input below.\r\n\r\nExample: 'Bearer 12345abcdef'&quot;,&#10;                Name = &quot;Authorization&quot;,&#10;                In = Microsoft.OpenApi.Models.ParameterLocation.Header,&#10;                Type = Microsoft.OpenApi.Models.SecuritySchemeType.Http,&#10;                Scheme = &quot;bearer&quot;,&#10;                BearerFormat = &quot;JWT&quot;&#10;            });&#10;            c.AddSecurityRequirement(new Microsoft.OpenApi.Models.OpenApiSecurityRequirement&#10;            {&#10;                {&#10;                    new Microsoft.OpenApi.Models.OpenApiSecurityScheme&#10;                    {&#10;                        Reference = new Microsoft.OpenApi.Models.OpenApiReference&#10;                        {&#10;                            Type = Microsoft.OpenApi.Models.ReferenceType.SecurityScheme,&#10;                            Id = &quot;Bearer&quot;&#10;                        }&#10;                    },&#10;                    new string[] {}&#10;                }&#10;            });&#10;        });&#10;        &#10;        // Application Layer&#10;        builder.Services.AddApplication();&#10;        &#10;        // Persistence Layer&#10;        builder.Services.AddPersistance(builder.Configuration);&#10;        &#10;        // Infrastructure Layer&#10;        builder.Services.AddInfrastructure();&#10;        &#10;        // Identity&#10;        builder.Services.AddIdentity&lt;AppUser, IdentityRole&gt;(opt =&gt;&#10;        {&#10;            opt.Password.RequireDigit = true;&#10;            opt.Password.RequireLowercase = true;&#10;            opt.Password.RequireUppercase = true;&#10;            opt.Password.RequireNonAlphanumeric = false;&#10;            opt.User.RequireUniqueEmail = true;&#10;            opt.Lockout.MaxFailedAccessAttempts = 5;&#10;            opt.Lockout.AllowedForNewUsers = true;&#10;            opt.Lockout.DefaultLockoutTimeSpan = TimeSpan.FromMinutes(5);&#10;            opt.SignIn.RequireConfirmedEmail = true;&#10;            opt.Password.RequiredLength = 6;&#10;        }).AddEntityFrameworkStores&lt;AppDbContext&gt;()&#10;          .AddDefaultTokenProviders();&#10;&#10;        // JWT Authentication&#10;        var jwtSettings = builder.Configuration.GetSection(&quot;JwtSettings&quot;);&#10;        var secretKey = jwtSettings[&quot;SecretKey&quot;] ?? throw new InvalidOperationException(&quot;JWT SecretKey not configured&quot;);&#10;        &#10;        builder.Services.AddAuthentication(options =&gt;&#10;        {&#10;            options.DefaultAuthenticateScheme = JwtBearerDefaults.AuthenticationScheme;&#10;            options.DefaultChallengeScheme = JwtBearerDefaults.AuthenticationScheme;&#10;        })&#10;        .AddJwtBearer(options =&gt;&#10;        {&#10;            options.TokenValidationParameters = new TokenValidationParameters&#10;            {&#10;                ValidateIssuer = true,&#10;                ValidateAudience = true,&#10;                ValidateLifetime = true,&#10;                ValidateIssuerSigningKey = true,&#10;                ValidIssuer = jwtSettings[&quot;Issuer&quot;],&#10;                ValidAudience = jwtSettings[&quot;Audience&quot;],&#10;                IssuerSigningKey = new SymmetricSecurityKey(Encoding.UTF8.GetBytes(secretKey)),&#10;                ClockSkew = TimeSpan.Zero&#10;            };&#10;        });&#10;&#10;        builder.Services.AddAuthorization();&#10;&#10;        // CORS&#10;        builder.Services.AddCors(options =&gt;&#10;        {&#10;            options.AddPolicy(&quot;AllowAll&quot;, policy =&gt;&#10;            {&#10;                policy.AllowAnyOrigin()&#10;                      .AllowAnyMethod()&#10;                      .AllowAnyHeader();&#10;            });&#10;        });&#10;&#10;        var app = builder.Build();&#10;&#10;&#10;        // Configure the HTTP request pipeline.&#10;        app.UseSwagger();&#10;        app.UseSwaggerUI(c =&gt;&#10;        {&#10;            c.SwaggerEndpoint(&quot;/swagger/v1/swagger.json&quot;, &quot;RestaurantManagment API V1&quot;);&#10;            c.RoutePrefix = &quot;swagger&quot;;&#10;            c.DocumentTitle = &quot;RestaurantManagment Swagger&quot;;&#10;            c.EnablePersistAuthorization(); // Bearer token için&#10;        });&#10;        app.MapOpenApi();&#10;&#10;        // CORS - ÖNEMLİ: En başta olmalı&#10;        app.UseCors(&quot;AllowAll&quot;);&#10;        &#10;        app.UseHttpsRedirection();&#10;        app.UseAuthentication();&#10;        app.UseAuthorization();&#10;        app.MapControllers();&#10;&#10;        app.Run();&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>